# Диаграмма классов
## **Диаграмма классов**

![](https://github.com/IliaKataev/KataevZvedenuk/blob/59c9d7971595823b6400c1f01531dcc92cd86fbe/erd%20diargam/erd.png)

---


### **1. ApplicationController**
Контроллер заявок отвечает за обработку запросов пользователя, передавая их в сервис и возвращая результаты.

#### Методы:
- `submitApplication(application: Application): void` – для подачи заявки, передаем её в сервис для обработки и сохранения.
- `getApplicationsByUser(userId: int): List<Application>` – получить все заявки пользователя.
- `updateApplicationStatus(applicationId: int, newStatus: ApplicationStatus): void` – изменение статуса заявки. Для госслужащих, которые могут изменять статус заявки.

### **2. ApplicationService**
Решает, как должна быть обработана заявка, применяя правила и взаимодействуя с репозиториями.

#### Методы:
- `applyRules(application: Application): boolean` – применяет все правила к заявке и решает, можно ли её принять или отклонить.
- `createApplication(application: Application): void` – создание новой заявки.
- `updateApplication(application: Application): void` – обновление заявки.
- `getApplicationsByStatus(status: ApplicationStatus): List<Application>` – получение заявок по статусу.
- `assignStatusAndDeadline(application: Application): void` – установить статус и рассчитать дедлайн для заявки.

### **3. ApplicationRepository**
Взаимосвязь с БД заявок.

#### Методы:
- `save(application: Application): void` – сохранение заявки.
- `getById(id: int): Application` – получение заявки по ID.
- `getByUser(userId: int): List<Application>` – заявки пользователя.
- `delete(applicationId: int): void` – удаление заявки.

### **4. MapController**
Контроллер для услуг. Обрабатывает запросы, связанные с услугами.

#### Методы:
- `getMap(id: int): Map` – получение услуги по ID.
- `createMap(map: Map): void` – создание услуги.
- `updateMap(map: Map): void` – обновление услуги, если это необходимо.

### **5. MapService**
Сервис услуги, обрабатывает логику активации/деактивации и управления услугами.

#### Исправленные методы:
- `getMaps(): List<Map>` – получить все услуги.
- `activateMap(mapId: int): void` – активация услуги.
- `deactivateMap(mapId: int): void` – деактивация услуги.
- `getMapById(mapId: int): Map` – получение услуги по ID.

### **6. MapRepository**
Репозиторий для услуг, отвечает за взаимодействие с БД.

#### Методы:
- `save(map: Map): void` – сохранение услуги.
- `getById(id: int): Map` – получение услуги по ID.
- `delete(serviceId: int): void` – удаление услуги.

### **7. ApplicationStatus** (Перечисление)

- `На рассмотрении`
- `Оказана`
- `Отклонена`
- `Отменена`

### **8. UserRole** (Перечисление)

- `Гражданин`
- `Администратор`
- `Госслужащий`

### **9. Application**
Application представляет заявку, поданную пользователем через систему. Включает информацию о пользователе, карте, статусе заявки, сроках её выполнения и описания результата

#### Поля:
- `id: int` – уникальный идентификатор заявки.
- `user: User` – пользователь, подавший заявку.
- `map: Map` – услуга, к которой относится заявка.
- `status: ApplicationStatus` – статус заявки.
- `resultDescription: string` – описание результата (для возврата пользователю).
- `creationDate: Date` – дата создания заявки.
- `closureDate: Date` – дата закрытия заявки.
- `deadline: int` – срок исполнения заявки.

#### Методы:
- `validate(): boolean` – проверка заявки на корректность перед подачей.
- `updateStatus(newStatus: ApplicationStatus): void` – обновление статуса заявки.
- `calcDeadline(): Date` – расчет дедлайна заявки.

### **10. User**
User представляет пользователя системы. Это может быть гражданин, госслужащий или администратор. Пользователь-админ или госслужащий может взаимодействовать с заявками, создавать новые или изменять существующие. 

#### Поля:
- `id: int` – уникальный идентификатор пользователя.
- `fullName: string` – полное имя пользователя.
- `login: string` – логин пользователя.
- `password: string` – пароль.
- `role: UserRole` – роль пользователя.

#### Методы:
- `updateParameters(newData: User): void` – обновление параметров пользователя.
- `interactWithApplication(map: Map): Application` – создание заявки пользователем.

### **11. Услуга**
Сущность, представляющая услугу, которая может быть выбрана в рамках заявки. Услуга может быть активной или неактивной и будет иметь связанное описание и даты активации/деактивации.

#### Поля:
- `id: int` – уникальный идентификатор карты.
- `name: string` – название карты.
- `description: string` – описание карты.
- `activationDate: Date` – дата активации карты.
- `deactivationDate: Date` – дата деактивации карты.

#### Методы:
- `isActive(): boolean` – проверка на активность карты.
- `activate(): boolean` – активация карты.
- `deactivate(): boolean` – деактивация карты.

### **12. Rule**
Правило, которое применяется к заявке для её проверки и утверждения. Каждое правило связано с определённым набором условий

#### Поля:
- `id: int` – уникальный идентификатор правила.
- `value: string` – значение правила (например, ограничение времени).
- `comparisonOperator: string` – оператор сравнения для проверки.
- `getInDays: int` – срок действия правила.
- `timeLimit: int` – лимит времени для проверки.

#### Методы:
- `resolve(user: User, application: Application): boolean` – метод, который будет применяться к заявке для её проверки с использованием правила.

### **13. RuleRepository**
Репозиторий для работы с базой данных.

#### Методы:
- `save(rule: Rule): void` – сохранение правила.
- `getByService(serviceId: int): List<Rule>` – получение всех правил для услуги.
- `delete(ruleId: int): void` – удаление правила.

### **14. RuleService**
Сервис для обработки правил.

#### Методы:
- `applyRules(application: Application): boolean` – применить все правила к заявке.
- `getRulesForService(serviceId: int): List<Rule>` – получить все правила для услуги.

### **15. UserController**
Контроллер для пользователей.

#### Методы:
- `getUser(id: int): User` – получение пользователя по ID.
- `updateUser(user: User): void` – обновление данных пользователя.
- `login(login: string, password: string): User` – аутентификация пользователя.

### **16. UserService**
Сервис для пользователей.

#### Методы:
- `authenticate(login: string, password: string): User` – аутентификация пользователя.
- `register(user: User): void` – регистрация нового пользователя.

### **17. UserRepository**
Репозиторий для пользователей.

#### Методы:
- `save(user: User): void` – сохранение пользователя.
- `getById(id: int): User` – получение пользователя по ID.
- `delete(userId: int): void` – удаление пользователя.

### **18. ParameterRepository**
Репозиторий для работы с параметрами.

#### Методы:
- `save(parameter: Parameter): void` – сохранение параметра.
- `getByUser(userId: int): List<Parameter>` – получение параметров пользователя.
- `delete(parameterId: int): void` – удаление параметра.

### **19. Parameter**
Параметр, который связан с пользователем и определяет его дополнительные характеристики или настройки. Параметры могут быть изменены пользователем и влияют на процесс подачи заявки

#### Поля:
- `id: int` – уникальный идентификатор параметра.
- `user: User` – пользователь, которому принадлежит параметр.
- `type: ParameterType` – тип параметра.
- `value: string` – значение параметра.

#### Методы:
- `getValue(): string` – получение значения параметра.
- `updateValue(newValue: string): void` – обновление значения параметра.

### **20. ParameterService**
Сервис для работы с параметрами.

#### Методы:
- `getParametersForUser(userId: int): List<Parameter>` – получить параметры для пользователя.

### **21. ParameterType**
Тип параметра, который определяет структуру и допустимые значения для параметров пользователей. Например, тип параметра может быть "Возраст" или "Размер", и для каждого типа будет свой набор возможных значений.

#### Поля:
- `id: int` – уникальный идентификатор типа.
- `code: string` – код типа параметра.
- `name: string` – название типа параметра.

#### Методы:
- `getCode(): string` – получение кода типа параметра.

### **22. ParameterController**
Контроллер для работы с параметрами.

#### Методы:
- `getParameters(userId: int): List<Parameter>` – получить параметры пользователя.
- `createParameter(parameter: Parameter): void` – создание нового параметра.

---

### Связи между классами

**Application** — **User** (Агрегация):  
Заявка агрерирует пользователя, так как каждая заявка привязана к одному пользователю, который ее подает. Заявка может существовать независимо от пользователя, однако всегда ссылается на конкретного пользователя для обработки и хранения.

**Application** — **Map** (Ассоциация):  
Заявка ассоциирована с услугой, которая определяет контекст и условия заявки. Одна заявка привязана к одной услуге, но услуга может быть использована в нескольких заявках.

**Application** — **ApplicationStatus** (Зависимость):  
Заявка зависит от статуса, который определяет текущее состояние заявки (например, на рассмотрении, отклонена). Статус является предопределенным значением, и заявка может изменять свой статус в процессе обработки.

**Application** — **ApplicationRepository** (Агрегация):  
Репозиторий заявки управляет созданием, сохранением, обновлением и удалением заявок в базе данных. Он предоставляет все необходимые операции для работы с заявками и хранением их данных.

**Application** — **ApplicationController** (Ассоциация):  
Контроллер заявки связан с сущностью заявки для обработки входящих запросов и передачи данных от пользователя. Контроллер использует методы сущности заявки для обработки заявок (например, создание, изменение статуса).

**ApplicationService** — **RuleService** (Зависимость):  
Сервис заявок зависит от сервиса правил для применения бизнес-логики, связанной с проверкой правил, например, для проверки заявок на соответствие условиям.

**MapService** — **ApplicationRepository** (Зависимость):  
Сервис услуг зависит от репозитория заявок для работы с заявками, привязанными к услугам. Он может запрашивать заявки, обновлять их и проверять их состояния в контексте услуги.

**MapService** — **MapRepository** (Зависимость):  
Сервис услуг использует репозиторий услуг для взаимодействия с услуги: получение, сохранение и изменение услуг. Это позволяет сервису эффективно управлять услугами.

**MapController** — **MapRepository** (Зависимость):  
Контроллер услуг использует репозиторий услуг для получения данных об услугах, а также для создания и обновления услуг. Контроллер является связующим звеном между пользователем и репозиторием.

**UserService** — **UserRepository** (Зависимость):  
Сервис пользователей зависит от репозитория пользователей для аутентификации, регистрации и управления пользователями. Все операции с пользователями происходят через репозиторий.

**UserController** — **UserService** (Зависимость):  
Контроллер пользователей использует сервис пользователей для обработки запросов на регистрацию, аутентификацию и обновление данных пользователя. Сервис содержит всю логику для работы с пользователями, а контроллер делегирует задачи.

**UserController** — **UserRepository** (Зависимость):  
Контроллер пользователей зависит от репозитория пользователей для извлечения данных о пользователях. Контроллер может запросить репозиторий для получения конкретного пользователя по ID, удаления пользователя или его обновления.

**ParameterService** — **ParameterRepository** (Ассоциация):  
Сервис параметров ассоциирован с репозиторием параметров, так как сервис использует репозиторий для извлечения, сохранения и удаления параметров для пользователей. Параметры, связанные с пользователем, обрабатываются сервисом, который делегирует операции репозиторию для взаимодействия с базой данных.

**ParameterController** — **ParameterService** (Ассоциация):  
Контроллер параметров зависит от сервиса параметров, так как контроллер получает запросы от пользователя (например, для создания или получения параметров) и использует сервис для выполнения логики обработки этих запросов. 

**RuleService** — **RuleRepository** (Ассоциация):  
Сервис правил зависит от репозитория правил, так как сервис использует репозиторий для получения, сохранения и удаления правил, связанных с услугами. 

**ParameterController** — **ParameterRepository** (Ассоциация):  
Контроллер параметров использует репозиторий параметров для извлечения, создания и удаления параметров пользователя.

**UserController** — **ParameterService** (Зависимость):  
Контроллер пользователей зависит от сервиса параметров, так как он может запрашивать параметры пользователя через сервис, например, для отображения их в интерфейсе или для обновления данных. Сервис управляет логикой работы с параметрами, и контроллер делегирует запросы на его выполнение.

---

